2024-09-12 16:40

Tags: Projects, BlueTeamLab

# Networking 

It's important to secure our VLAN 99 which is going to be our Malware analysis VLAN if we do not implement the correct security practices we risk infecting other machines or even our physical machine so we have to be careful we already blocked all traffic on the VLAN 99 so now we have to figure out a way to download malware on the machines in there.
the easiest way is to download malware on the DFIR VM and then use SCP to move it to the Malware analysis machines  

## Windows malware analysis VM

we are going to use MSEdge on Win11 VM and we will install Flare VM on top of it flare VM is a Windows-based security distribution for malware analysis 

we download it from [here](https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/) after downloading it we will keep the default settings and only expand the HDD and keep it on the NAT network adapter for the activation and the installation of Flare VM later we gonna change it to VLAN 99 

when you are done installing Windows you can log in without a password, now we have to stop Windows updates and disable both Windows Firewall and Windows Defender you can take a snapshot now just in case but I did not 

now we can start installing Flare VM which you can download from [here](https://github.com/mandiant/flare-vm) to start the installation we have to copy the install.ps1 file to the Desktop and Enable script execution Enable script execution:

- `Set-ExecutionPolicy Unrestricted -Force`
  
Unblock the installation script:

- `Unblock-File .\install.ps1`
  
now execute the installer script as follows:

- `.\install.ps1`

now just chill it's going to take a while :) it took 3 hours for me or better you can skip to the REMnux installation part, after it finishes now we have to configure  SSH before switching the Network adapter 

### SSH 

Run PowerShell as an admin and type the following command 
`Get-WindowsCapability -Online | ? Name -like 'OpenSSH*'
you should get an output that looks like this 

```
Name: OpenSSH.Client~~~~0.0.1.0
State: Installed

Name: OpenSSH.Server~~~~0.0.1.0
State: NotPresent
```

so we have to install the OpenSSH.Server component 
we can do that using the following command :

`Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0`

if you get OpenSSH.Client state: Not Present do the same command and instead of server type Client 
Now we can start the service by: 

`Start-Service sshd`

and to make it run on start-up  we can use this command: 

`Set-Service -Name sshd -StartType 'Automatic"`

### Network Configuration 

Now you can change the Network adapter to VLAN 99 and start configuring the Static IP

![StaticIPs](/Attachment/Image22.png)

Done now we have a fully installed and ready-to-use machine with SSH enabled 
we are not going to enable SSH on the Linux machine we can simply move the files from the Flare VM which is more work but it is more secure (we do not have SSH on every machine :() )

## REMnux

Download REMnux from [here](https://docs.remnux.org/install-distro/get-virtual-appliance) which is a Malware analysis and reverse-engineering distro 
after opening the OVA file just set the network adapter to NAT so we can update the system using 

`sudo apt update & sudo apt upgrade -y`

after the update change the adapter to VLAN 99 and edit `/etc/netplan/01-netcfg.yaml`
so it looks like this :

```
network:
  version: 2
  renderer: networkd
  ethernets:
    ens3:
      dhcp4: no
      addresses: [10.0.99.22/24]
      gateway4: 10.0.99.254
      nameservers:
          addresses: [10.0.99.254]
          search: [evil.corp]
```

save it then execute the `sudo netplan apply` command and verify the changes 

![REMnux](/Attachment/Image23.png)

Done 
# References 

[Building Blue Team Home Lab Part 5 - Malware Analysis | facyber](https://facyber.me/posts/blue-team-lab-guide-part-5/)
